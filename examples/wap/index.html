<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Dominant Color Extractor (Comparison)</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 2rem;
        }

        input {
            margin-bottom: 1rem;
        }

        #imagePreview {
            max-width: 300px;
            max-height: 300px;
            margin: 1rem auto;
            border: 1px solid #ccc;
            border-radius: 10px;
            display: none;
        }

        .palette-container {
            margin-top: 2rem;
            padding: 1rem;
            border: 1px solid #ccc;
            border-radius: 10px;
        }

        .palette-container h2 {
            font-size: 1.2rem;
            margin-bottom: 1rem;
        }

        .palette {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 1rem;
        }

        .color-box {
            width: 120px;
            height: 120px;
            border-radius: 12px;
            color: white;
            font-weight: bold;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 0.5rem;
            text-shadow: 0 0 3px rgba(0, 0, 0, 0.7);
        }

        canvas {
            display: none;
        }

        #error {
            color: red;
            margin-top: 1rem;
        }
    </style>
</head>

<body>
    <h1>Dominant Color Extractor</h1>
    <input type="file" id="imageInput" accept="image/*">
    <img id="imagePreview" alt="Image Preview">
    <canvas id="canvas"></canvas>
    <div id="error"></div>
    <div class="palette-container">
        <h2>PaletteAndroidX (接近 Android Palette)</h2>
        <div id="paletteAndroidX" class="palette"></div>
    </div>

    <script src="palette-androidx.js"></script>
    <script>
        const imageInput = document.getElementById('imageInput');
        const imagePreview = document.getElementById('imagePreview');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const paletteAndroidXDiv = document.getElementById('paletteAndroidX');
        const paletteKMeansDiv = document.getElementById('paletteKMeans');
        const errorDiv = document.getElementById('error');

        function rgbToHex(r, g, b) {
            return (
                '#' +
                [r, g, b]
                    .map((x) => {
                        const hex = x.toString(16);
                        return hex.length === 1 ? '0' + hex : hex;
                    })
                    .join('')
            );
        }

        function displaySwatches(swatches, container, implementation) {
            container.innerHTML = '';
            for (const [name, color] of Object.entries(swatches)) {
                if (!color) continue;
                const hex = rgbToHex(color.r, color.g, color.b);
                const div = document.createElement('div');
                div.className = 'color-box';
                div.style.backgroundColor = hex;
                div.style.color = color.textColor ? `rgb(${color.textColor.join(',')})` : '#fff';
                div.innerHTML = `<div>${name}</div><div>${hex}</div>`;
                container.appendChild(div);
            }
        }

        imageInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file) return;

            const img = new Image();
            img.onload = () => {
                imagePreview.src = img.src;
                imagePreview.style.display = 'block';
                errorDiv.textContent = '';

                const maxSize = 200;
                const scale = Math.min(maxSize / img.width, maxSize / img.height, 1);
                const newW = Math.floor(img.width * scale);
                const newH = Math.floor(img.height * scale);
                canvas.width = newW;
                canvas.height = newH;
                ctx.clearRect(0, 0, newW, newH);
                ctx.drawImage(img, 0, 0, newW, newH);

                try {
                    const imageData = ctx.getImageData(0, 0, newW, newH);

                    // PaletteAndroidX
                    const customOptions = {
                        filters: [
                            ([r, g, b]) => {
                                const luminance = (0.2126 * r + 0.7152 * g + 0.0722 * b) / 255;
                                return luminance > 0.05 && luminance < 0.95;
                            }
                        ],
                        region: { left: 0, top: 0, right: newW / 2, bottom: newH / 2 },
                        resizeArea: 112 * 112
                    };

                    const swatchesAndroidX = PaletteAndroidX.extractSwatches(imageData, 16);
                    displaySwatches(swatchesAndroidX, paletteAndroidXDiv, 'PaletteAndroidX');

                    // 打印对比信息
                    console.log('PaletteAndroidX:', swatchesAndroidX);
                } catch (e) {
                    errorDiv.textContent = `Error: ${e.message}`;
                    console.error('Error processing image:', e);
                }
            };
            img.onerror = () => {
                errorDiv.textContent = 'Error: Failed to load image';
            };
            img.src = URL.createObjectURL(file);
        });
    </script>
</body>

</html>